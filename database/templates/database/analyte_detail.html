{% extends "base.html" %}
{% load i18n %}
{% load static %}

{% block title %}Search Stability Database{% endblock %}

{% block content %}

    {% if "Blood" in object.specimen.name %}
        <h4 class="display-5">{{ object.name }} {% if object.details %} - {{ object.details }}{% endif %}
            in {{ object.specimen.name }}</h4>

        {#    <div id="tabs" hx-get="{% url 'analyte_blood' %}" hx-trigger="load delay:100ms" hx-target="#tabs" hx-swap="innerHTML"></div>#}


        <div class="card">
            <div class="card-header">
                <h5 class="card-title">Stability Data</h5>
                <ul class="nav nav-tabs card-header-tabs" data-bs-tabs="tabs">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="true" data-bs-toggle="tab" href="#blood">Blood</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="tab" href="#urine">Urine</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="tab" href="#csf">CSF</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="tab" href="#saliva">Saliva</a>
                    </li>
                </ul>
            </div>
            <div class="card-body tab-content">
                <div class="tab-pane active" id="blood">
                    <p class="card-text">
                    <div class="row">
                        <div class="col">
                            <strong>Categories</strong>
                            <br>
                            {% for cat in object.category.all %}
                                {{ cat.name }}<br>
                            {% endfor %}
                        </div>
                        <div class="col">
                            <h5>LOINC
                                Number: <a href="{{ object.loinc_url }}" target="_blank"> {{ object.loinc_num }}</a>
                            </h5>

                        </div>
                    </div>

                    <br>


                    <table class="table">
                        <thead>
                        <tr>
                            <th scope="col">Tube</th>
                            <th scope="col">Type</th>
                            <th scope="col">Comment</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <th scope="row">Recommended</th>
                            <td>
                                {% for tube in object.tube_recomm.all %}
                                    {{ tube.name }}
                                {% endfor %}
                            </td>
                            <td>
                                {% if object.tube_recomm_comment %}
                                    {{ object.tube_recomm_comment }}
                                {% endif %}
                            </td>

                        </tr>
                        <tr>
                            <th scope="row">Possible</th>
                            <td>
                                {% for tube in object.tube_possible.all %}
                                    {{ tube.name }}
                                {% endfor %}
                            </td>

                            <td>
                                {% if object.tube_possible_comment %}
                                    {{ object.tube_possible_comment }}
                                {% endif %}
                            </td>

                        </tr>
                        <tr>
                            <th scope="row">Maybe Possible</th>
                            <td>
                                {% for tube in object.tube_maybeposs.all %}
                                    {{ tube.name }}
                                {% endfor %}
                            </td>

                            <td>
                                {% if object.tube_maybeposs_comment %}
                                    {{ object.tube_maybeposs_comment }}
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">Not recommended</th>
                            <td>
                                {% for tube in object.tube_not.all %}
                                    {{ tube.name }}
                                {% endfor %}
                            </td>

                            <td>
                                {% if object.tube_not_comment %}
                                    {{ object.tube_not_comment }}
                                {% endif %}
                            </td>
                        </tr>
                        </tbody>
                    </table>

                    <div class="row">
                        <div class="col">
                            <h5><a href="{{ analyte.cvi_url }}" target="_blank">Biological Variation
                                of {{ analyte.name }} in {{ analyte.specimen.name }}</a></h5>
                        </div>
                        <div class="col">
                            <h5>Biological HalfLife</h5>
                            {{ object.bhl_min }} - {{ object.bhl_max }} <br>
                            {% if object.bhl_comment %} {{ aobject.bhl_comment }} {% endif %} <br>
                            {% if object.bhl_literature %} Source:
                                 {% for lit in object.bhl_literature.all %}


                                     <!-- Button trigger modal -->
<a href="#" data-bs-toggle="modal" data-bs-target="#literatureModal">
  {{ lit.lit_no }}
</a> |

<!-- Modal -->
<div class="modal fade" id="literatureModal" tabindex="-1" aria-labelledby="literatureModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="literatureModalLabel">Modal title</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        {{ lit.authors }}. {{ lit.title }}. {{ lit_source }} <br>
          DOI: <a href="https://doi.org/{{ lit.doi }}">{{ lit.doi }}</a> <br>
          <a href="{{ lit.url }}">Link</a>
      </div>
    </div>
  </div>
</div>
                                {% endfor %}

                            {% endif %}
                        </div>
                    </div>

                    </p>
                </div>
                <div class="tab-pane" id="urine">
                    <p class=" card-text">URINE.</p>
                </div>
                <div class="tab-pane" id="csf">
                    <p class=" card-text">CSF.</p>
                </div>
                <div class="tab-pane" id="saliva">
                    <p class=" card-text">SALIVA.</p>
                </div>

            </div>
        </div>

    {% endif %}


    {% if "CSF" in object.specimen.abbr %}
        <h4 class="display-5">{{ object.name }} {% if object.details %} - {{ object.details }}{% endif %}
            in {{ object.specimen.name }}</h4>

        {#    <div id="tabs" hx-get="{% url 'analyte_blood' %}" hx-trigger="load delay:100ms" hx-target="#tabs" hx-swap="innerHTML"></div>#}


        <div class="card">
            <div class="card-header">
                <h5 class="card-title">Stability Data</h5>
                <ul class="nav nav-tabs card-header-tabs" data-bs-tabs="tabs">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="true" data-bs-toggle="tab" href="#blood">Blood</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" aria-current="true" data-bs-toggle="tab" href="#urine">Urine</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="tab" href="#csf">CSF</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="tab" href="#saliva">Saliva</a>
                    </li>
                </ul>
            </div>
            <div class="card-body tab-content">
                <div class="tab-pane active" id="blood">
                    <p class="card-text">
                    <div class="row">
                        <div class="col">

                            <strong>Categories</strong>
                            <br>
                            {% for cat in object.category.all %}
                                {{ cat.name }}<br>
                            {% endfor %}
                        </div>
                        <div class="col">
                            <h5>LOINC
                                Number: <a href="{{ object.loinc_url }}" target="_blank"> {{ object.loinc_num }}</a>
                            </h5>

                        </div>
                    </div>

                    <br>


                    <table class="table">
                        <thead>
                        <tr>
                            <th scope="col">Tube</th>
                            <th scope="col">Type</th>
                            <th scope="col">Comment</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <th scope="row">Recommended</th>
                            <td>
                                {% for tube in object.tube_recomm.all %}
                                    {{ tube.name }}
                                {% endfor %}
                            </td>
                            <td>{{ object.tube_recomm_comment }}</td>
                        </tr>
                        <tr>
                            <th scope="row">Possible</th>
                            <td>
                                {% for tube in object.tube_possible.all %}
                                    {{ tube.name }}
                                {% endfor %}
                            </td>
                            <td>{{ object.tube_possible_comment }}</td>

                        </tr>
                        <tr>
                            <th scope="row">Maybe Possible</th>
                            <td>
                                {% for tube in object.tube_maybeposs.all %}
                                    {{ tube.name }}
                                {% endfor %}
                            </td>
                            <td>{{ object.tube_maybeposs_comment }}</td>
                        </tr>
                        <tr>
                            <th scope="row">Not recommended</th>
                            <td>
                                {% for tube in object.tube_not.all %}
                                    {{ tube.name }}
                                {% endfor %}
                            </td>
                            <td>{{ object.tube_not_comment }}</td>
                        </tr>
                        </tbody>
                    </table>

                    <div class="row">
                        <div class="col">
                            <h5><a href="{{ analyte.cvi_url }}" target="_blank">Biological Variation
                                of {{ analyte.name }} in {{ analyte.specimen.name }}</a></h5>
                        </div>
                    </div>

                    </p>
                </div>
                <div class="tab-pane" id="urine">
                    <p class=" card-text">URINE.</p>
                </div>
                <div class="tab-pane" id="csf">
                    <p class=" card-text">CSF.</p>
                </div>
                <div class="tab-pane" id="saliva">
                    <p class=" card-text">SALIVA.</p>
                </div>

            </div>
        </div>

    {% endif %}
{% endblock %}