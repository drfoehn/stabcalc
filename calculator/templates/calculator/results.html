{% extends "base.html" %}
{% load i18n static average %}

{% block title %}Instruments{% endblock %}

{% block content %}

<div class="jumbotron">
  <h1 class="display-4">Results - Stability study "{{ setting.name }}"</h1>
  <p class="lead">This is a simple hero unit, a simple jumbotron-style component for calling extra attention to featured content or information.</p>
  <hr class="my-4">
</div>

    <div class="row ">
    <div class="col">
        <table class="table table-hover">
            <thead class="th_analytical">
            <th>Parameter:</th>
            <td>{{ setting.parameter.name }} ({{ setting.parameter.unit}})</td>
            </thead>


            <tr>
                <th>Instrument:</th>
                <td>{{ setting.parameter.instrument }}</td>
            </tr>
            <tr>
                <th>Reagent:</th>
                <td>{{ setting.parameter.reagent_name }}<br>
                    {{ setting.parameter.reagent_manufacturer}}
                </td>
            </tr>
            <tr>
                <th>Manual method:</th>
                <td>{% if setting.parameter.method_hand == True %}
                    Yes
                    {% else %}
                    No
                    {% endif %}</td>
            </tr>
            <tr>
                <th>Method Intra CV%</th>
                <td>{{ setting.parameter.CV_intra}} %</td>
            </tr>
            <tr>
                <th>Method Inter CV%</th>
                <td>{{ setting.parameter.CV_inter}} %</td>
            </tr>
        </table>
        </div>
    <div class="col">
        <table class="table table-hover">
            <thead>
                <th class="th_condition" colspan="2">Storage Conditions</th>
            </thead>
            <tr>
                <th>Sample</th>
                <td>
                    Sample Type: {{ setting.parameter.sample.get_sample_type_display}} <br>
                    Additive: {{ setting.parameter.sample.get_container_additive_display}}<br>
                    Container: {{ setting.parameter.sample.container_fillingvolume}} mL /
                                {{ setting.parameter.sample.get_container_dimension_display}} /
                                {{ setting.parameter.sample.get_container_material_display}}
                    Seperator (Gel): {% if setting.parameter.sample.gel == True %}
                    Yes
                    {% else %}
                    No
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>Temperature</th>
                <td>
                {{ setting.condition.get_temperature_display }}
                </td>
            </tr>
        <tr>
                <th>Other condition</th>
                <td>{{ setting.condition.other_Condition }}</td>
            </tr>
                <tr>
                    <th colspan="2">Exposure during storage to...</th>
                </tr>
            <tr>
                <th>...light</th>
                <td>
                    {% if setting.condition.light == True %}
                    Yes
                    {% else %}
                    No
                    {% endif %}
                    </td>
            </tr>
            <tr>
                <th>...air</th>
                <td>
                    {% if setting.condition.air.light == True %}
                    Yes
                    {% else %}
                    No
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>...agitation</th>
                <td>

                    {% if setting.condition.agitation == True %}
                    Yes
                    {% else %}
                    No
                    {% endif %}
                </td>
            </tr>

        </table>

    </div>

<hr class="my-4">
    <div class="col">

    <canvas id="myChart" width="400" height="150"></canvas>
    <script>
        const ctx = document.getElementById('myChart');
        const myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [{% for duration in setting.duration_set.all %} '{{ duration }}', {% endfor %}],
                datasets: [
                    {
                        borderColor: 'rgba(255, 159, 64, 1)',
                        backgroundColor: 'rgba(255, 206, 86, 1)',
                        {#fill: 'origin',#}
                        borderWidth: 5,
                        borderCapStyle: 'round',
                        borderJoinStyle: 'round',
                        itemRadius: 10,
                        spanGaps: true,
                        label: 'Averages at selected timepoints',
                    data: [
                        {% for duration in setting.duration_set.all %} {% average_tot setting duration %},
                {% endfor %}],

                },
                {
                    type: 'line',
                    label: '+SD',
                    spanGaps: true,
                    data: [{% for duration in setting.duration_set.all %} {% avg_tot_sd_h setting duration %},
                {% endfor %}],
                },
                {
                    type: 'line',
                    label: '-SD',
                    spanGaps: true,
                    data: [{% for duration in setting.duration_set.all %} {% avg_tot_sd_l setting duration %},
                {% endfor %}],
                }]

            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            text: ['lalalal'],
                        }
                    }
                }
            }
        });
    </script>
</div>
    <hr class="my-4">




    </div>

    <div class="row">
    <div class="col">
        <button type="button" class="btn btn-primary" href="{% url 'add_results' %}">Add Result</button>
    </div>
        <div class="col">
        <button type="button" class="btn btn-primary" href="{% url 'add_results' %}">Print</button>
    </div>
        <div class="col">
        <button type="button" class="btn btn-primary" href="{% url 'add_results' %}">Export</button>
    </div>
    </div>

    <hr class="my-4">

    <div class="row">

<div class="col">
        <table class="table table-hover">
            <thead class="th_results">
            <tr>
                <th scope="col">Subject</th>
                {% for duration in setting.duration_set.all %}
                    <th>{{ duration }}</th>
                {% endfor %}

            </tr>
            </thead>
            <tbody>
              <tr class="total_results">
                <td>No of subjects: {{ subjects.count }}</td>
                {% for duration in setting.duration_set.all %}
                    <td>
                        AVG Total: {% average_tot setting duration %} <br>
                        SD Total:  {% stdv_tot setting duration %} <br>
                        CV% Total:  {% cv_tot setting duration %}
                    </td>
                {% endfor %}
            </tr>
            {% for subject in subjects %}

                <tr>
                    <th scope="row">{{ subject }}</th>
                    {% for duration in setting.duration_set.all %}
                        <td>
                            {% for replicate in subject.replicate_set.all %}
                                {% for result in replicate.result_set.all %}
                                    {% if result.duration == duration %}
                                        {% if result.subject == subject %}
                                        {{ result }}<br>

                                    {% endif %}
{#TODO: Alle Werte werden bei Sub1 angezeigt#}

                                    {% endif %}
                                {% endfor %}
                            {% endfor %}
                            <hr/>
                            AVG: {% average subject duration %}<br>
                            SD: {% stdv subject duration %}<br>
                            CV: {% cv subject duration %}<br>
{#                            DEV%: {% deviation subject duration %}#}
                        </td>
                    {% endfor %}

                    <td></td>
                </tr>
            {% endfor %}

            </tbody>



        </table>





</div>

</div>
{% endblock %}