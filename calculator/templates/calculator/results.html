{% extends "base.html" %}
{% load i18n static average %}

{% block title %}Instruments{% endblock %}

{% block content %}



    <div class="row d-flex justify-content-center">


    {{ setting.name }}<br>
    {{ setting.parameter.name }} ({{ setting.parameter.unit}})<br>
    {{ setting.parameter.sample}}<br>
    {{ setting.parameter.instrument }}<br>
    {{ setting.parameter.reagent_name }}<br>
    {{ setting.parameter.reagent_manufacturer}}<br>
    {{ setting.parameter.method_hand}}<br>

    {{ setting.parameter.CV_intra}}<br>
    {{ setting.parameter.CV_inter}}<br>
    {{ setting.condition.temperature }}<br>
    {{ setting.condition.light }}<br>
    {{ setting.condition.air }}<br>
    {{ setting.condition.agitation }}<br>
    {{ setting.condition.other_Condition }}<br>


        <table class="table table-hover" style="border: solid 1px black">
            <thead>
            <tr>
                <th scope="col">Subject</th>

                {#                 {% for subject in subjects %}#}
                {#                {% for replicate in subject.replicate_set.all %}#}
                {% for duration in setting.duration_set.all %}
                    {#                                {% ifchanged %}#}
                    <th>Duration: {{ duration }}</th>
                    {#{% endifchanged %}#}
                {% endfor %}
                {#            {% endfor %}#}
                {#            {% endfor %}#}
                {#                <th scope="col">Average</th>#}
                {#                <th scope="col">CV%</th>#}
            </tr>
            </thead>
            <tbody>
            {% for subject in subjects %}
                <tr>
                    <th scope="row">{{ subject }}</th>

                    {% for duration in setting.duration_set.all %}
                        <td>
                            {% for replicate in subject.replicate_set.all %}
                                {% for result in replicate.result_set.all %}
                                    {% if result.duration == duration %}

                                        {{ result }} <br>
{#TODO: Alle Werte werden bei Sub1 angezeigt#}
                                        Subject: {{ result.subject }}<br>
                                    {% endif %}
                                {% endfor %}
                            {% endfor %}
                            <hr/>
                            AVG: {% average subject duration %}<br>
                            SD: {% stdv subject duration %}<br>
                            CV: {% cv subject duration %}
                        </td>
                    {% endfor %}

                    <td></td>
                    {#                    <td>#}
                    {#                        {% for replicate in subject.replicate_set.all %}#}
                    {#                            {% for result in replicate.result_set.all %}#}
                    {#                            {% if forloop.first %}#}
                    {#                                Avg: {% average subject result.duration %} / {{ subject }} / {{ result }} /#}
                    {#                                {{ result.duration }}#}
                    {#                            {% endif %}#}
                    {#                            {% endfor %}#}
                    {#                        {% endfor %}#}
                    {#                    </td>#}
                    {#                    <td>CV%</td>#}

                </tr>
            {% endfor %}

            </tbody>
            <tfoot>
            <tr>
                <td>No of subjects: {{ subjects.count }}</td>
                {% for duration in setting.duration_set.all %}
                    <td>AVG Total: {% average_tot setting duration %}</td>
                {% endfor %}
            </tr>
            </tfoot>
        </table>
    </div>


    <a href="{% url 'add_results' %}">add result</a>



    <canvas id="myChart" width="400" height="200"></canvas>
    <script>
        const ctx = document.getElementById('myChart');
        const myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [{% for duration in setting.duration_set.all %} '{{ duration }}', {% endfor %}],
                datasets: [
                    {
                        borderColor: 'rgba(255, 159, 64, 1)',
                        backgroundColor: 'rgba(255, 206, 86, 1)',
                        fill: 'origin',
                        borderWidth: 5,
                        borderCapStyle: 'round',
                        borderJoinStyle: 'round',
                    itemRadius: 10,
                        spanGaps: true,
                        label: 'Averages at selected timepoints',
                    data: [{% for duration in setting.duration_set.all %} {% average_tot setting duration %},
                {% endfor %}],
                    {#backgroundColor: [#}
                    {#    'rgba(255, 99, 132, 1)',#}
                    {#    'rgba(54, 162, 235, 1)',#}
                    {#    'rgba(255, 206, 86, 1)',#}
                    {#    'rgba(75, 192, 192, 1)',#}
                    {#    'rgba(153, 102, 255, 1)',#}
                    {#    'rgba(255, 159, 64, 1)'#}
                    {#],#}
                    {#borderColor: [#}
                    {#    'rgba(255, 99, 132, 1)',#}
                    {#    'rgba(54, 162, 235, 1)',#}
                    {#    'rgba(255, 206, 86, 1)',#}
                    {#    'rgba(75, 192, 192, 1)',#}
                    {#    'rgba(153, 102, 255, 1)',#}
                    {#    'rgba(255, 159, 64, 1)'#}
                    {#],#}

                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            text: ['lalalal'],
                        }
                    }
                }
            }
        });
    </script>


{% endblock %}